---
title: "607:  Assignment 2"
author: "Nilsa Bermudez"
date: "2/9/2020"
output:
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
    highlight: zenburn
---


library(DBI);
library(ggplot2);



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

In this open ended assignment, I will load the data two ways.  First from sql,then I will generate a barplot and then from a csv file.  
- Run the MovieSurvey.sql script on "https://raw.githubusercontent.com/nilsabermudez/607/master/MovieSurvey.sql"
- Load the data from the database
- List the tables
- Populate the variables for BarPlot
- Show the BarPlot
- List the movies by average rating as shown in BarPlot
- Load the data into an R dataframe from the csv file from github 



## Load the data from the database

```{r GetData, echo=TRUE}
con =  DBI::dbConnect(RMySQL::MySQL(), user="root", password="root", dbname="movies", host="localhost")
result <- DBI::dbGetQuery(con, "select name, Age, Parent, MovieName, Rating from Reviewers 
          inner join Ratings on Reviewers.ID =Ratings.ReviewerID inner join Movies on Movies.ID =Ratings.MovieID;")
```

## List the tables

```{R listTables}
DBI::dbListTables(con)
```

```{r HeadResults}
head(result)
```


## Populate variables for a bar plot

```{r   plotbar}
res <- DBI::dbGetQuery(con, "SELECT m.ID AS MovieID, AVG(r.rating) AS avg_rating
                                  FROM ratings r 
                                  INNER JOIN
                                      movies m ON r.movieid = m.id
                                  GROUP BY m.ID
                                  ORDER BY AVG(r.rating) DESC; ")

barplot(height=res$avg_rating, names.arg = res$MovieID, xlab = "Movie ID", ylab ="Average Rating", main = "Friends' Movie Ratings", col.main="red", font.main=8)
```

## Movies by average rating as shown in BarPlot

```{r}
ShowMovieDetail <- DBI::dbGetQuery(con, "SELECT m.ID, m.MovieName, AVG(r.rating) AS avg_rating
                                  FROM ratings r 
                                  INNER JOIN
                                      movies m ON r.movieid = m.id
                                  GROUP BY m.ID, m.MovieName
                                  ORDER BY AVG(r.rating) DESC;")
ShowMovieDetail
```
# My friends are all moviegoers.  They saw all 6 movies.  However, if a rating of 0 meant they had not seen the movie, this would be the result:


```{r}
ShowMovieDetailExcluding0 <- DBI::dbGetQuery(con, "SELECT m.ID, m.MovieName, AVG(r.rating) AS avg_rating
                                  FROM ratings r 
                                  INNER JOIN
                                      movies m ON r.movieid = m.id
                                  where r.rating <>0
                                  GROUP BY m.ID, m.MovieName
                                  ORDER BY AVG(r.rating) DESC;")
ShowMovieDetailExcluding0 
```

# Load the data from the csv file from github 

```{r}
ratingsdf <- read.csv("https://raw.githubusercontent.com/nilsabermudez/607/master/MovieRatingsRaw.csv",header = TRUE, sep = ",")

head(ratingsdf)
```

# Show the worst movies (according to my friends)

```{r}
subset(ratingsdf, (Rating == 0))
```

